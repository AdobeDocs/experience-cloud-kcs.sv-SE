---
title: Migrera användare, grupper och åtkomstkontrollistor mellan AEM instanser
description: Beskrivning
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: af761579c3fb5e51cf5f4d144bff0e058fd13911
workflow-type: tm+mt
source-wordcount: '954'
ht-degree: 0%

---

# Migrera användare, grupper och åtkomstkontrollistor mellan AEM instanser

## Beskrivning

Migrera användare och grupper med ACL-behörigheter i AEM från en server till en annan eller från en AEM till en annan.

## Upplösning

**Steg 1: Hitta administratörer och anonyma användare**

1. Gå till CRXDE Lite-appen `/crx/de/index.jsp` och logga in som admin-användare (i källsystemet).
1. Gå till &quot;Verktyg&quot; = &quot;Fråga&quot;.
1. Ange den här frågan i rutan &quot;Fråga&quot; längst ned för att hitta administratörsanvändaren: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="admin" .`*
1. Klicka på Kör och kopiera sökvägen till administratörsanvändarnoden i resultatet till en textfil.
1. Upprepa steg 3 med en fråga för anonym användare: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="anonymous" .`*
1. Klicka på Kör och kopiera sökvägen till den anonyma användarnoden i resultatet till en textfil (så nu har du två sökvägar, en för&quot;admin&quot; och en för&quot;anonym&quot;).

   Exempel:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - admin-användare i källsystemet

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonym användare i källsystemet

**Steg 2A: Migrera användare och grupper (med `crx2oak` eller `oak-upgrade`)**

Användare och grupper kan migreras mellan AEM instanser med [crx2oak](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) eller [oak-upgrade](https://jackrabbit.apache.org/oak/docs/migration.html) verktyg.

1. Ladda ned `crx2oak` eller `oak-upgrade` jar som matchar den Oak-version du använder: 
   1. Oak-upgrade: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   1. Crx2Oak: [Maven Repository](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
1. Överför filen jar till AEM
1. Stoppa AEM (käll- och målinstanser)
1. Ersätt namnet på filen jar i kommandot nedan.
1. Ersätt *`/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib`* i *`--exclude-paths`* en del av kommandoparametern nedan med sökvägarna för admin och anonyma användare från källsystemet.
1. Ändra sökvägarna på raden så att de matchar din instans (lägg till *`segment-old:`* innan sökvägen, om det behövs, finns här [https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): *`/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository`*
1. Kör sedan kommandot i serverns skal.

   ```
   java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \
   --include-paths=/home \
   --merge-paths=/home \
   --exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \
   segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &
   ```

1. När du är klar går du till steg 3 för att migrera åtkomstkontrollistorna.  Om du inte kan migrera med `crx2oak` följer du sedan stegen för paketmigrering nedan i stället.

**Steg 2B: Migrera användare och grupper (med paket)**

Om användarna inte importerades automatiskt via LDAP/SAML-autentisering eller `CRX2Oak` (metod A ovan) kan du paketera användare och grupper.  I det här fallet skapar du två separata paket i det gamla systemet (exklusive admin och anonyma användare som inte ingår i paketet).

1. Kopiera sökvägen för anonyma noder och administratörsanvändarnoder från resultaten i steg 1 (&quot;Hitta admin och anonyma användare&quot;) ovan.

   Exempel:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - admin-användare på datorn där jag skapar paketet

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonym användare på datorn där jag skapar paketet

1. Gå till &quot;Package Manager&quot;, *`http://host:port/crx/packmgr/index.jsp`* och logga in som administratör.
1. Skapa paketet &quot;users&quot;
1. Lägg till ett filter i paketkonfigurationen för `/home/users` med dessa exkluderingsregler (på `/home/users` filter):
   1. `exclude /home/users/.\*/.tokens`
   1. `exclude /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv`
   1. `exclude /home/users/K/Kj1406Qo9IDODc_nk5Ib`
   1. `exclude /home/users/a/admin`
   1. `exclude /home/users/a/anonymous`
   1. `exclude /home/users/system`
   1. `exclude /home/users/geometrixx`
   1. `exclude /home/users/media`
   1. `exclude /home/users/projects`
   1. `exclude /home/users/mac`
1. Bygg paketet.
1. Ladda ned paketet.
1. Zippa upp den paketerade zip-filen på datorn: `jar -xvf users.zip META-INF/vault/filter.xml`
1. Öppna filen `META-INF/vault/filter.xml` i en textredigerare.
1. Lägg till `mode="merge"` till filtret ... -tagg, till exempel:

   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```

1. Zippa upp det ändrade innehållet i paketet igen så att det innehåller ändringen.

   ```
   jar -uvf users.zip META-INF/vault/filter.xml
   ```

1. Skapa ett grupppaket som innehåller en filterregel `/home/groups`.
1. Upprepa steg 11-14 för grupppaketet.
1. (Endast uppgradering) Om du migrerar till en nyare AEM version ska du installera en ny lokal AEM *av den gamla versionen*(utan innehåll), och installera användarpaketet och sedan grupppaketet där. Utför sedan en uppgradering på plats till den nya versionen på den instansen. Detta konverterar användarna till den nya Oak-representationen. Efter uppgraderingen på plats packar du om användarna för att portera dem till den uppgraderade instansen. Gör samma sak för användargrupperna.
1. Installera användarpaketet på den nya datorn.
1. Installera grupppaketet på den nya datorn.
1. Om du migrerar från en äldre AEM till 6.3 går du till `/useradmin` Användargränssnitt och lägg till användarreplikeringsmottagaren i gruppen &quot;administratörer&quot;.

**Steg 3. Migrera åtkomstkontrollistor**

Om du kan installera verktyg (ACS-kommandon) för att AEM, gör du så här:

1. Hämta och installera ACS Commons.
1. Följ stegen här för att skapa ett ACL-paket.
1. Gå till http://aem-host:port/crx/packmgr/index.jsp and inloggning som administratör.
1. Klicka på ACL-paketet.
1. Klicka på Redigera.
1. Välj [!UICONTROL Advanced] (se skärmbild nedan).
1. I listrutan AC-hantering väljer du [!UICONTROL Merge] för att undvika att ta bort befintliga åtkomstkontrollistor i målsystemet. Detta är särskilt viktigt när du migrerar ACL:er mellan olika versioner av AEM (eftersom det inte går att ta bort ACL:er från lådan).

Om du *not* kan installera verktyg (ACS Commons) för att AEM och sedan följa dessa steg. Observera att datorn där du kör kommandona måste vara Mac OS, [!DNL Linux], eller [!DNL Windows] (med [!DNL Cygwin]) med cURL, [!DNL Python]och [!DNL Java] SDK är installerat.

1. Gå till http://src-aem-host:port/crx/packmgr/index.jsp and inloggning som administratör.
1. Skapa ett paket med namnet&quot;ACL-migrering&quot;
1. Klicka på knappen Redigera.
1. Välj [!UICONTROL Advanced] och ställa in AC-hanterarläge på Sammanfoga.
1. Spara.
1. Bygg paketet och ladda ned det.
1. Kör det här kommandot på paketet för att extrahera `META-INF/vault/filter.xml` fil: 

   ```
   jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. I samma katalog kör du det här kommandot för att hämta en JSON-fil med ACL-sökvägarna under `/content` från källinstansen (ange användarnamn och lösenord och rätt värd): 

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json
   ```

1. Skapa en fil `generate-package-filter.py` och klistra in [!DNL Python] kod nedan: 

   ```
   import json
   from pprint import pprint
   
   with open ('data.json') as data_file:
      data = json.load(data_file)
   
   print("?xml version=\"1.0\" encoding=\"UTF-8\"?")
   print("workspaceFilter version=\"1.0\"")
   
   for item in data "results":
       print("filter root=\"{path}\" /" . format(path=item "path"))
   
   print( "/workspaceFilter")
   ```

1. Kör [!DNL Python] skript från samma mapp där data.json skapades och spara utdata i `META-INF/vault/filter.xml` (ersätta befintligt innehåll i `filter.xml`): 

   ```
   python generate-packge-filter.py  META-INF/vault/filter.xml
   ```

1. Använd det här kommandot för att uppdatera `filter.xml` i zip-filen:

   ```
   jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. Överför zip-filen till källinstansens pakethanterare: http://src-aem-host:port/crx/packmgr/index.jsp
1. Klicka [!UICONTROL Build] eller [!UICONTROL Rebuild] för att skapa paketet.
1. Hämta paketet från AEM.
1. Överför paketet till mål-AEM-serverns pakethanterare: http://dst-aem-host:port/crx/packmgr/index.jsp
1. Klicka [!UICONTROL Install] för att installera den.
1. Upprepa steg 8-16 för alla andra banor som ändrar kommandot för banvändning. Detta skulle till exempel få åtkomstkontrollistorna under `/etc` i stället för `/content`:

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   ```
