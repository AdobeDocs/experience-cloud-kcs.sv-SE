---
title: "Analysera minnesproblem"
description: Beskrivning
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/21/2021 5:18:56 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/21/2021 5:21:24 PM"
version-number: 1
article-number: KA-17482
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ef6bccf5-9232-ec11-b6e5-000d3a5ba97a"
exl-id: 48e49bcc-3d49-464e-8af9-e4292b1d6899
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '866'
ht-degree: 1%

---

# Analysera minnesproblem

## Beskrivning

<br>Symtom<br><br>
The [!DNL Java] programmet körs långsammare och har slut på minne eller så visas ett fel i loggarna eller i konsolutdata `OutOfMemoryError: Java heap space` eller `OutOfMemoryError: gc overhead limit exceeded`.
<br><br>Orsak<br><br>
Sådana problem kan ha många orsaker.

En möjlig orsak är att [!DNL Java] i vårt fall startades CRX/CQ från kommandoraden med standardinställningarna för heap-minne för [!DNL Java]. Detta innebär att parametern jvm `-Xmx` har inte angetts. CRX eller CQ behöver minst 256 MB stackutrymme för körning. Om detta är problemet måste du kontrollera att inställningarna för stackminnet är inställda från kommandoraden. Exempel:


```
java -Xmx512m -jar *.jar
```


Om så inte är fallet kan programmet behålla för många objekt utan att frigöra dem för skräpinsamlingen. Detta kallas för en minnesläcka. [här](http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/memleaks.html) för mer information. Se avsnittet nedan om hur du analyserar minnesproblem i Java-program.


## Upplösning

Skapa stackdump<br><br>Generera en heap dump automatiskt<br><br>
Om du vill skapa en heap dump automatiskt när minnet tar slut kan du lägga till jvm-parametern `-XX:+HeapDumpOnOutOfMemoryError` för att generera en heap dump automatiskt när programmet genererar en `OutOfMemoryError`. Exempel:


```
java -Xmx256m -XX:+HeapDumpOnOutOfMemoryError -jar *.jar
```


Detta genererar en stackdumpfil (`java_...hprof`) i processens arbetskatalog när `java` minnet tar slut. Processen kan fortsätta att köras efter att stackdumpen har skapats. Vanligtvis räcker det med en stackdumpfil för att analysera problemet.

<b>Obs!</b> om du använder `crx-quickstart/server/start` skript för att starta CRX-instansen kan du lägga till `-XX:+HeapDumpOnOutOfMemoryError` till `CQ_JVM_OPTS` (kontrollera att variabeln också är okommenterad). Exempel:


```
CQ_JVM_OPTS='-XX:+HeapDumpOnOutOfMemoryError'
```


När du har lagt till den här parametern och startat om CRX-instansen kontrollerar du att det nya jvm-alternativet har angetts. Kör `ps -ef | grep java` från kommandoraden. Kontrollera sedan om du ser `-XX:+HeapDumpOnOutOfMemoryError` som en parameter i CRX `java` -processen.

Om du behöver ange en annan katalog för att generera heap dump på grund av begränsningar för diskutrymme, kan du lägga till `-XX:HeapDumpPath=/path/to/generate/heapdump` -parameter som anger var jvm ska skicka filen.

Se [här](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp#DebuggingOptions) för en referens till felsökningsrelaterade jvm-parametrar.
<br><br>Generera en heap-dump manuellt<br><br>
<b>[!DNL Sun]/Oracle JVM</b>

Om du vill generera en heap-dump manuellt kör du det här kommandot (jmap and jps can found in the `bin` mapp i din jdk-arbetskatalog):

1. ta en titt på `java` processen som du genererar en heap dump för.
   - I [!DNL Unix] eller [!DNL Linux] detta kan göras med `ps -ef | grep java` eller `jps -l`
   - I [!DNL Windows] detta kan du göra genom att öppna aktivitetshanteraren, trycka på `Ctrl+Shift+Esc` sedan gå till <b>Visa</b> = <b>Markera kolumner</b> = <b>PID (Process Identifier)</b> eller `jps -l`
2. Kör jmap-kommandot nedan, ersätt `/path/to/generate/heapdumpfile.hprof` med den plats där du vill generera stackdumpfilen och ersätta `1234` med den bild som du slog upp i föregående steg.

   ```
   jmap -dump:format=b,file=/path/to/generate/heapdumpfile.hprof 1234
   ```


<b>IBM JVM</b>

Du måste först ändra standardinställningarna för JVM för Dumpa agenter för att generera korrekta dumpar för användarsignalen. Det finns flera sorters dumpar, men du behöver vanligtvis den fullständiga <b>systemdump</b> för att utföra en grundlig minnesanalys. Lägg till följande argument:

<b>Xdump:heap:opts=PHD+CLASSIC:events=user -Xdump:system:events=user</b>

Den här användarhändelsen inträffar när JVM tar emot SIGQUIT ([!DNL Linux], AIX®, z/OS® och i5/OS™) eller SIGBREAK ([!DNL Windows]) från operativsystemet.

Mer information finns i leverantörens dokumentation [här](http://pic.dhe.ibm.com/infocenter/java7sdk/v7r0/index.jsp?topic=%2Fcom.ibm.java.aix.70.doc%2Fdiag%2Fpreface%2Fchanges_70%2Foverview_gc.html).

<b>Varning:</b> Heap dump-filer är stora och kan ha upp till samma storlek på disken som din högsta heap `-Xmx` jvm-parameterkonfiguration. Se till att du har tillräckligt med diskutrymme tilldelat katalogen där dumpfilen genereras.
<br><br>Analysera heapdump<br><br>
Ett bra verktyg för att analysera stackdumpar är [!DNL Eclipse] MAT ([!DNL Eclipse Memory Analyzer]): [http://www.eclipse.org/mat/](http://www.eclipse.org/mat/)

Det här verktyget kan inte analysera <b>IBM JVM</b> genererade dumpar. För dem finns det flera möjligheter. [IBM HeapAnalyzer](https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=4544bafe-c7a2-455f-9d43-eb866ea60091) fungerar bra för stackdumpar i PHD- eller klassiskt format.

Använd [IBM Support Assistant Workbench](http://www-01.ibm.com/software/support/isa/) , med [IBM övervaknings- och diagnostikverktyg för Java - Minnesanalys version 1.2](http://www.ibm.com/developerworks/java/jdk/tools/memoryanalyzer/) installeras överst.
<br><br>Histogram för heap<br><br>
Histogrammet för heap är ett enkelt mått på antalet objekt och det minne som används per [!DNL Java] klassen. Olyckligtvis, beroende på [!DNL Java] de verktyg som krävs kanske inte är tillgängliga eller fungerar inte alltid. Om du vill skapa ett heap-histogram måste du först ha process-ID:t för [!DNL Java] -processen. För att få det, kör `ps` eller (om tillgängligt), kör:


```
jps -l
```


Detta [!DNL Java] används för att hämta process-ID:n för alla [!DNL Java] -processer. Exempel:


```
327 
3332 sun.tools.jps.Jps
3313 crx-quickstart-....jar
```


Kör följande kommando:


```
jmap -histo 3313
```


Listan sorteras efter totalt minne som krävs (grund: exklusive refererade objekt). De första 20 raderna i utdata är de mest intressanta. Exempelutdata:


```
JVM version is 1.5.0_20-141
Iterating over heap. This may take a while...
Warning: skipping invalid TLAB for thread t@62211
Warning: skipping invalid TLAB for thread t@62467
...
SizeCountClass description
-------------------------------------------------------
1059290412916byte
1028584075255* ConstMethodKlass
628317658388char
604230414928int
4995752116201* SymbolKlass
422089675255* MethodKlass
41965126969* ConstantPoolKlass
29285606969* InstanceKlassKlass
26310086066* ConstantPoolCacheKlass
2395872149742org.apache.jackrabbit.core.query.lucene.DocId$PlainDocId
14760087003java.util.HashMap$Entry
139612858172java.lang.String
107023244593java.util.HashMap$Entry
75398410036short
73546454org.apache.jackrabbit.core.query.lucene.DocId
7201927502java.lang.Class
64070413348com.day.crx.persistence.tar.index.IndexEntry
...
```


<b>Ytterligare information</b>

För att analysera problemet behöver vi också veta följande:

- CRX- eller CQ-version, inklusive en lista över alla installerade versionsnummer för snabbkorrigeringar.
- Operativsystem, JVM-leverantör och version.


<b>Referenser</b>

1 [http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/memleaks.html](http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/memleaks.html)
2 [http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp#DebuggingOptions](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp#DebuggingOptions)
