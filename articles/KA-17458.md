---
title: Optimera [!DNL Dispatcher] cache
description: Beskrivning
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/20/2021 7:12:29 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:45:44 PM
version-number: 1
article-number: KA-17458
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee6e74a7-d931-ec11-b6e5-000d3a5ba97a
exl-id: 84871fce-d53d-4a1d-aabf-ccf8c8c47810
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1409'
ht-degree: 0%

---

# Optimera [!DNL Dispatcher] cache

## Beskrivning


Den här artikeln fokuserar på de senaste optimeringarna i AEM Dispatcher och hur du bäst utnyttjar dem.  AEM Dispatcher är en cachelagring [omvänd proxy](https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server) server som är avsedd att användas med Adobe Experience Manager.  Den kan installeras och köras som en modul i ett befintligt webbserverprogram.  När den här artikeln skrivs är [avsändarmodulen stöds](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html) på [!DNL Apache HTTP Server], Microsoft IIS och [!DNL iPlanet].


## Upplösning

<br><br>Så här fungerar Dispatcher Caching<br><br><br><br><br><br>
På den mest grundläggande nivån är AEM Dispatcher en omvänd proxy som fungerar genom att utföra cachelagring, tömning av cache och cacheogiltigförklaring.

Mer information om dispatcher finns i de relaterade länkarna:

1. [Hur dispatchern fungerar och hur den installeras](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher.html).
2. [Konfigurationsalternativ som är tillgängliga i dispatchern](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html).
3. [Webbinarium om hur dispatchern fungerar](https://github.com/cqsupport/webinar-dispatchercache) - Observera att viss information i presentationen baseras på äldre versioner av dispatchern.
4. [Gems webbinariesession om dispatcherfunktioner, CDN-användning och -säkerhet](https://docs.adobe.com/ddc/en/gems/dispatcher-caching---new-features-and-optimizations.html).
5. [Gems-session om nyare funktioner i dispatcher (efter v4.1.9)](https://helpx.adobe.com/experience-manager/kt/eseminars/gems/aem-dispatcher.html).

<br><br><br><br><br><br>Optimera Dispatcher-cachen<br><br><br><br><br><br>
Här är några sätt att optimera dispatchercachen:

1. <b>Cachelagra nästan allt</b> - det innebär att allt innehåll som användarna begär mer än en gång cachelagras.
2. <b>Cachelagra anpassat innehåll under olika tidsperioder</b> - Om din webbplats har personaliserat innehåll bör du överväga att använda [[!DNL Apache Sling Dynamic Includes]](https://helpx.adobe.com/experience-manager/kt/platform-repository/using/sling-dynamic-include-technical-video-setup.html) i AEM [!DNL Ajax] (Asynkrona JavaScript- och XML-anrop på webbläsarnivå), SSI (Server Side Includes på webbservernivå) och ESI (Edge-side Includes på CDN-nivå) för att cachelagra olika delar av sidan under olika tidsperioder.
3. <b>Ta aldrig bort dispatchercachen för en direktdispatcher</b> - Om en dispatcher skickar live-innehåll och du tar bort cachen, kommer detta att få en enorm mängd förfrågningar att skickas tillbaka till AEM.  På grund av detta bör dispatchercachen aldrig tas bort för en direktdispatcher.
4. <b>Använd cacheminnet </b>- Innan du tar bort [!DNL Dispatcher] cache, dra [!DNL Dispatcher] Ta bort cacheminnet från belastningsutjämnaren och kör sedan ett webbcrawlningsverktyg för att cachelagra filer på dispatchern innan du placerar den på belastningsutjämnaren.
5. <b>Cachelagra felsidor</b> - Utnyttja <b>[DispatcherPassError 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html#ApacheWebServer) </b>([!DNL Apache] Web Server-specifikt) för att hantera felsidor som 404s från dispatchercachen.
6. <b>GZip komprimerar alla filtyper utom de som är förkomprimerade </b>- in [!DNL Apache] Webbserver, [mod_deflate](https://httpd.apache.org/docs/2.4/mod/mod_deflate.html) kan användas, men se till att <b>`Vary: User-Agent` </b>header<b> </b>är inte inställt.  I Microsoft IIS använder du [Dynamisk komprimering](https://docs.microsoft.com/en-us/iis/configuration/system.webserver/httpcompression/).

   [!DNL Apache] exempel på konfiguration (ange endast vissa innehållstyper för att undvika förkomprimerade filtyper):

   `AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript`
7. <b>Aktivera [/serveStaleOnError](https://helpx.adobe.com/experience-manager/kb/ServeStaleContentOnError.html)</b> i `/cache` configuration - serva den gamla cachefilen när AEM förekomster ger upphov till fel.
8. <b>Lägg till [/GracePeriod](https://docs.adobe.com/content/help/en/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)</b> till `/cache` configuration - define the number of seconds a stale, auto-invalidated resource may still from the cache after the last content publish event (&quot;activation&quot;).  Detta minskar antalet begäranden som går tillbaka till publiceringsinstanser under en stor publiceringsaktivitet, till exempel&quot;Trädaktivering&quot;.
9. <b>Lägg till regler i [/ignoreUrlParams](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#IgnoringURLParameters)</b> - ignorera frågesträngsparametrar som inte är obligatoriska eller som används av programmet.  Detta tillåter cachelagring av URL:er även när en frågesträng finns.
10. <b>Cachelagra headers för Cache-Control och Last-Modified response</b> - Använd<b> [/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b> konfiguration för cache-lagring av HTTP-svarshuvuden <b>`Cache-Control`</b> och <b>`Last-Modified` </b>(och/eller <b>`ETag`</b> om du skickar det från AEM).  Detta underlättar när det gäller att förenkla och optimera cachning på CDN- och webbläsarnivå.  Cachelagring av dessa rubriker gör att bara AEM anger rubrikerna, inte själva webbservern.  Observera att när du gör detta måste du börja skicka sidhuvuden från AEM program.
11. <b>Cachelagra innehållet så länge som möjligt</b> och <b>minska antalet förfrågningar som går tillbaka till AEM</b> - Optimera rensningsbegäranden genom att aktivera [uppdatera](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#refetching-flush) Alla penselagenter.  Eller använd [<b>/enableTTL</b>](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) och ange <b>`Cache-Control: max-age=...`</b> för att cachelagra filer så länge som möjligt.  Se [nedan](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) om du vill ha mer information om det här ämnet.

<br><br><br><br><br><br>Använda TTL<br><br><br><br><br><br>
Från och med [!DNL Dispatcher] version 4.1.11, [/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL) kan anges i `.any` filkonfiguration.  Den här inställningen gör att cacheminnet för avsändarrespekt anges i HTTP `Cache-Control` svarshuvud.  Med andra ord fungerar dispatchern på ungefär samma sätt som ett CDN där den primära formen av cacheogiltigförklaring inträffar när filerna förfaller.  När du implementerat detta och börjat skicka <b>`Cache-Control: max-age=...` </b>för alla svar från AEM kan du inaktivera dina dispatcherrensningsagenter på ett säkert sätt i publiceringsinstanserna.

När du har inaktiverat rensningsagenter på publiceringsinstanserna kanske du ändå vill kunna tömma dispatchercachen.  I så fall kan du använda [ACS-kommandon - användargränssnittet Dispatcher Flush](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html).  Det här verktyget är installerat på författarinstansen.  Det ger användarna ett användargränssnitt där de kan utföra manuella cachetömningsbegäranden.

<b>Jag. Steg för att aktivera ogiltiga TTL-format (&quot;Time to Live&quot; eller utgångsdatum):</b>

1. Ändra källkoden i AEM program som ska skickas <b>`Cache-Control` </b>header och <b>`Last-Modified` </b>för alla begäranden där det inte redan har angetts.
2. Installera [!DNL Dispatcher] 4.1.11 eller senare.
3. Ange <b>[/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL)</b> i `.any` platsens servergruppskonfiguration.
4. Ange <b>[/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders) </b>konfiguration som cachelagrar <b>`Cache-Control`</b> och <b>`Last-Modified`</b> rubriker.
5. Starta om webbservern.


<b>II. Inaktivera rensningsagenter för dispatcher på publiceringsinstanserna:</b>

Dispatchern kommer nu att använda `Cache-Control` om du vill styra ogiltigförklaringen av cachefilerna.  Eftersom så är fallet behövs inte längre någon dispatcher som tömmer publiceringsinstanserna.

1. Gå till `/etc/replication/agents.publish.html` på varje publiceringsinstans.
2. Gå till varje rensningsagentkonfiguration och inaktivera agenten.


<b>III. Tillåt manuella begäranden om tömning av dispatcher från författarinstansen:</b>

Nu när tömningsagenter är inaktiverade kan du helt förlita dig på <b>`Cache-Control` </b>för att styra när innehåll uppdateras i dispatchern.  Du kan fortfarande tillåta användare att göra manuella tömningar av dispatchercachen:

1. Installera [ACS-kommandon - användargränssnittet Dispatcher Flush](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) på författarinstansen.
2. Konfigurera rensningsagenter på författarinstansen.
3. Ange <b>Utlösare</b> = <b>Ignorera standard </b>till aktiverat. Det här alternativet gör att justeringsagenterna ignoreras när användare klickar på <b>(Un)Publicera </b>eller <b>(De)Aktivera</b> i AEM.

<br><br><br><br><br><br>Återhämtning av Dispatcher Flush<br><br><br><br><br><br>
Om du vill optimera begäranden om tömning av dispatcher ska alla rensningsagenter för dispatcher ha en funktion som kallas uppdatering av tömning aktiverad.

Så här aktiverar du omhämtning av dispatcher-rensning:

1. Gå till <b>*http://aemhost:port*/crx/packmgr/index.jsp</b> och logga in som administratör.
2. Hämta paketet från [här](https://github.com/cqsupport/webinar-dispatchercache/blob/master/packages/dispatcher-flush-refetch-samplecode-1.0.zip?raw=true).
3. Överför och installera paketet till pakethanteraren.
4. Gå till din konfiguration för rensningsagent för dispatcher. Till exempel <b>/etc/replication/agents.author/flush.html</b>
5. Klicka på <b>[!UICONTROL Edit]</b>
6. Ange följande
   - <b>Serialiseringstyp</b> = <b>Hämta rensning av avsändare igen</b>
   - <b>Utökad</b> = <b>HTTP-metod</b> = <b>POST</b>
7. Klicka på <b>[!UICONTROL Save]</b>


Observera att paketet som installeras ovan bara är ett grundläggande exempel.  Om du vill anpassa och optimera omhämtning kan du ändra listan med URI:er som skickas.  Koden är öppen källkod och kan hittas [här](https://github.com/cqsupport/webinar-dispatchercache/tree/master/src/refetching-flush-agent/refetch-bundle).  Koden lägger till en lista med URI:er i begärandetexten som parametrar som talar om för dispatcher vilka sökvägar som ska hämtas igen.  Du kan lägga till fler sökvägar enligt dina programkrav för att optimera webbplatsens cachningsfunktioner.
<br><br><br><br><br><br>En mer detaljerad förklaring om hur du återhämtar rensning<br><br><br><br><br><br>
Normalt fungerar en rensning av en dispatcher genom att filer tas bort:

1. Touch `.stat` fil(er)
2. Ta bort `/content/foo.\*`
3. Ta bort `/content/foo/_jcr_content`


På grund av att filer tas bort i steg 2 begär en användare en fil som `/content/foo.html` eller `/content/foo.json`, medan filen&quot;hämtas igen&quot;, kommer efterföljande förfrågningar för samma fil också att skickas till publiceringsinstanserna tills filen cache-lagras.  För långsamma svar eller sidor med stor trafik, till exempel hemsidor, kan detta orsaka att publiceringsinstansnivån flödar.

Du löser det här problemet genom att aktivera en funktion i dispatchern som kallas omhämtning.  Med den här funktionen kan du skicka en lista över URI:er som dispatchern proaktivt ska&quot;hämta om&quot; och ersätta borttagningen i stället för att ta bort.

Se 22:41-27:05 i detta [presentationsinspelning](https://my.adobeconnect.com/p7th2gf8k43) för en demonstration av hur det fungerar och hur du konfigurerar det.
