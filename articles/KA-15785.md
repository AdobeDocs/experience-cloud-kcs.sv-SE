---
title: Campaign Classic V7 - Optimera SQL-fråga som genereras i guiden Databasuppdatering
description: Beskrivning
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Marta Zator
article-created-date: 5/5/2022 10:16:35 AM
article-published-by: Marta Zator
article-published-date: 5/5/2022 10:18:58 AM
version-number: 2
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e810bb6a-5ccc-ec11-a7b5-6045bd00dbbc
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '366'
ht-degree: 0%

---

# Campaign Classic V7 - Optimera SQL-fråga som genereras i guiden Databasuppdatering

## Beskrivning


<b>Bakgrund och sammanhang:</b>
I de flesta Campaign-byggen, inklusive Gold Standard 9032, kan det uppstå flera problem när nya kolumner läggs till i ett befintligt schema.

Artikelns omfattning är att åtgärda ett specifikt problem som rör :

- Lägga till ett heltalsfält i ett befintligt schema när det redan finns poster.
- Optimera SQL-frågan som genereras av programmet till Effektiv för Postgres SQL.


<b>Användningsfall:</b> 
<br>Vi har ett befintligt mottagarregister eller något annat register som redan har mer än 1 miljon poster.
<br>Vi måste nu lägga till en extra kolumn till den tabellen som är av datatypen heltal.
<br>Vi lägger till den kolumnen i schemadefinitionen och vill implementera ändringarna i databasen.

<b>Utmaning </b>:
<br>Ett problem uppstod när databasen skulle uppdateras och databasen stöter på ett dödläge eller så blockerar frågan andra åtgärder.
<br>Detta beror huvudsakligen på att alla poster har uppdaterats till 0 baserat på SQL-kommandot som genererats av databasguiden.


<br> <br>

## Upplösning


Lösning :

När du lägger till en heltalskolumn genereras SQL-satsen så här:

<b>ALTER TABLE NmsRecipient ADD column_name SMALLINT;
<br>UPPDATERA NmsRecipient SET column_name = 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN column_name SET Default 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN icolumn_name SET NOT NULL;</b>

Problemet här är att det finns fyra parallella kommandon som körs i databasen, vilket kan orsaka prestandaproblem eller ett dödläge.

Lösningen är att komprimera dessa fyra kommandon till ett och fortfarande göra samma ändringar som nedan:

<b>ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0;</b>

Den utför alla ändringar som krävs, lägger till kolumnen, anger standardvärdet, anger NOT NULL och anger värdet för befintliga poster till 0 på grund av NOT NULL-begränsningen.



<b>OBS!</b>

Om det finns flera heltalskolumner som behöver läggas till lägger du till dem en i taget och kör databasguiden för varje ändring.

Detta garanterar smidig funktion eftersom programsatsen uppdaterar alla <b>befintlig </b>till 0 och beroende på vilket som är det. av poster som kan ta tid.
