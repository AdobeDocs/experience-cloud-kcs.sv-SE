---
title: Så här kör du en konsekvenskontroll av datalager via ekvering
description: Beskrivning
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Akash Kapoor
article-created-date: 4/3/2022 9:37:38 PM
article-published-by: Akash Kapoor
article-published-date: 4/3/2022 9:39:46 PM
version-number: 2
article-number: KA-19064
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=68a58547-96b3-ec11-983f-000d3a5d09d6
exl-id: 8aec0830-a1db-4e57-95e4-3745e87bde32
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '392'
ht-degree: 0%

---

# Så här kör du en konsekvenskontroll av datalager via ekvering

## Beskrivning

Konsekvenskontrollen av datalagret rapporterar eventuella binära data som saknas men som fortfarande refereras. Konsekvenskontrollen kan aktiveras direkt av Felix console.<br>
Den kan aktiveras från MarkSweepGarbageCollector#checkConsistency Mbean

Om BlobGC MBeans är registrerad i MBeanServer kan även följande meny användas:

BlobGCMbean#checkConsistency

När konsekvenskontrollen är klar visas antalet binärfiler som rapporterats som saknade i ett meddelande. Om talet är större än 0 kan du kontrollera loggarna som konfigurerats för org.apache.jackrabbit.oak.plugins.blob.MarkSweepGarbageCollector för mer information om de binärfiler som saknas.

Nedan visas ett exempel på hur de saknade binärfilerna rapporteras i loggarna:

`11:32:39.673 INFO main MarkSweepGarbageCollector.java:600 Consistency check found 1 missing blobs 11:32:39.673 WARN main MarkSweepGarbageCollector.java:602 Consistency check failure in the the blob store : DataStore backed BlobStore org.apache.jackrabbit.oak.plugins.blob.datastore.OakFileDataStore, check missing candidates in file /tmp/gcworkdir-1467352959243/gccand-1467352959243`

Till skillnad från användargränssnittet för /system/console/databaseCheck kontrollerar körningsverktyget de dolda indexfilerna för lucen under /oak: index förutom resten av innehållssökvägarna. kommandot&quot;datastorecheck&quot; i <b>oak-run </b>kan användas för att utföra en konsekvenskontroll på datalagret.  Nedan beskrivs de detaljerade stegen för hur du kör kommandot:




## Upplösning


1. Ladda ned en ekrun jar 1.8.8 eller senare version till AEM.
2. Placera ekkörningsbehållaren i samma katalog där crx-quickstart är placerad. Annars anger du hela sökvägen till oak-run-\*.jar när du kör under kommandot.
3. Kör kommandot nedan (uppdatera sökvägarna till segmentlagret och datalagret enligt din miljö):


`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`

4. Kommandot skulle resultera i en konsekvenskontroll av datalagret.

Konsekvenskontroller för DataStore kan också användas för att lista alla blobreferenser i nodarkivet och alla blob-ID:n som finns i datalagret. Använd följande kommando:

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`



Ange ett eller flera av följande tillgängliga alternativ:

—id - Visa en lista med alla id:n i datalagret.

—ref - Visa alla blobreferenser i nodarkivet.

—consistent - Visa en lista över alla blobbar som saknas genom att göra en konsekvenskontroll.



Följande alternativ är valfria:

—store - Sökväg till segmentbutiken för mongo-uri (krävs för —ref och —consistent-alternativen ovan).

—dump - Sökväg till platsen där filerna ska dumpas (valfritt). I annat fall sparas filerna i användarens tmp-katalog.

—s3ds - Sökväg till konfigurationsfilen S3DataStore.

—fds - Sökväg till konfigurationsfilen FileDataStore (egenskapen path är obligatorisk).

—track - Sökväg till den lokala databasens hemmapp (valfritt). Den placerar en kopia av de hämtade blob-ID:n som ska spåras.
