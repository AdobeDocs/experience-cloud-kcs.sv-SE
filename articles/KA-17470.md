---
title: "Fel: För många öppna filer"
description: Beskrivning
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '0'
ht-degree: 0%

---

# Fel: För många öppna filer

## Beskrivning

<br><br><br>Problem<br><br><br><br><br><br>
Loggfilerna innehåller felet &quot;För många filer&quot; och AEM svarar inte.
<br><br><br><br><br><br>Orsak<br><br><br><br><br><br>
Orsaken är en av två möjligheter:

- Programmet stänger inte resurser som filer eller socketar när de har använts.
- Eller så kräver programmet fler öppna filer än vad processen tillåter.



## Upplösning

<br><br> <br><br><br><br><br><br>
Lösningen på problemet är:

1. Ta reda på vad som gör att gränsen för antalet öppna filer nås
2. Öka gränsen eller åtgärda programfelen.

<br><br><br><br>Söka efter vilka filer eller socklar som är öppna<br><br> <br><br>
\*\* Observera att begränsningar för öppna filer gäller för totalt antal öppna filer, rör och socketar, inte bara filer.

På [!DNL Linux] plattform, `lsof` kan användas för att felsöka vilka resurser som är öppna av processen.

Här finns ett exempelskript som du kan använda `lsof` utdata:
<br><br><br><br><br> <br><br><br><br>

```
#!/bin/bash` `if` `$` `# -eq 0` `  ` `then` `    ` `echo` `"No PID specified"` `    ` `echo` `"Run command with PID, for example:"` `    ` `echo` `"lsof-script.sh 12345"` `    ` `exit` `2` `fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID` `lsof` `-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt | ` `wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt |` `awk` `'{print $9}'` `|` `sed` `-e` `"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(repository/index\).*$/\1\2/"` `|` `sed` `-e` `"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/lib\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/logs\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/ext\).*$/\1\2/"` `|` `sort` `|` `uniq` `-c |` `sort` `-rn -k1` `lsof` `-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"` `lsof` `|` `wc` `-l` 
```


<br><br><br><br><br> <br><br>
Exempelutdata:
<br><br><br><br><br> <br><br><br><br>

```
 $ ./lsof-script.sh 18070 Files open by the process:      1995 Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt Total open files in OS:     18399 
```

<br><br><br><br><br> <br><br>
Inspect utdata från genererade `lsof-sorted-counts-\*.txt` -fil.  Den visar vilka filer eller socketar som för närvarande är öppna av processen.

Om du hittar öppna socketar eller filer i listan som inte ska vara öppna beror det troligtvis på ett programfel.  Uppdatera programkoden så att filer och socketar stängs när du har använt dem.

En vanlig orsak till att öppna socketar behålls är anpassad kod som gör webbtjänsten.  I många fall kan bibliotek som [!DNL Apache] [!DNL Commons HttpClient] används, men anslutningar stängs aldrig av utvecklarna.  Se [den här artikeln](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) för mer information om [!DNL Apache] [!DNL Commons HttpClient].
<br><br><br><br> <br><br>Öka gränsvärdet för gränssnittssessionen<br><br><br><br> <br><br>
Kontrollera användarens gräns för maximalt antal öppna filer och kör sedan följande som samma användare som AEM processen körs som:

`ulimit -Sn ulimit -Hn`

När du använder standardstartskriptet för AEM/CQ ökar du gränsen genom att göra följande:

1. Öppna `crx-quickstart/bin/start` för redigering
2. Lägg till variabeln `CQ_MAX_OPEN_FILES` längst upp i skriptet:    `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


Om felet visas `-bash: ulimit: open files: cannot modify limit: Operation not permitted` när du startar AEM fungerar inte konfigurationen ovan.

Du måste i stället öka gränsen i `/etc/security/limits.conf`. Nedan finns mer information om hur du konfigurerar om användargränsen.

Om du använder en tredjepartsprogramserver som [!DNL JBoss] eller [!DNL Websphere]följer du avsnitten nedan och kontrollerar med leverantörens dokumentation.

Obs!

Om ingen av konfigurationerna i den här artikeln löser problemet kan du se vilka filer som är öppna med kommandot `lsof -p`. (`-p` är process-id:t för den problematiska processen.) Det kan bero på att programmet lämnar filhandtagen öppna. Om du ser att handtagen i huvudsak hålls av AEM och inte av ditt program kontaktar du support.


<br><br><br><br> <br><br>Öka användarens gränser<br><br><br><br> <br><br>
Om du vill ändra det maximala antalet öppna filer för icke-rotanvändare ändrar du filen `/etc/security/limits.conf`. Du kan ange gränsen per användare:

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

Obs!

Den här konfigurationen börjar inte gälla förrän nästa gång användaren loggar in.


<br><br><br><br> <br><br>Öka systemgränsen<br><br><br><br> <br><br>
Ibland är användargränsen tillräckligt hög, men systemet har nått det maximala antalet filer. Kör följande som `su/root` användare:

1. Kontrollera inställningen för högsta antal öppna filer i operativsystemet (om den är under 20000 bör du öka den här inställningen).    `cat /proc/sys/fs/file-max`
2. Lägg till den här raden i `/etc/sysctl.conf` för att öka maxvärdet för öppna filer i systemet:    `fs.file-max = 300000`
3. Kör det här kommandot:    `sysctl -p`
4. Kontrollera att det nya värdet visas när du kör det här kommandot:    `cat /proc/sys/fs/file-max`


Obs!

Den här konfigurationen börjar inte gälla förrän nästa gång användaren loggar in.


<br><br><br><br> <br><br>Ytterligare information<br><br><br><br> <br><br>
Det här felet inträffar när systemet eller användaren använder det maximala antalet filhanterare.

LADDA NED
[Hämta fil](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>Shell-skript som du kan använda för att övervaka användningen av öppna filer. Använd bara det här skriptet om felet &quot;för många öppna filer&quot; kvarstår även efter att du har ökat maxvärdet. Du kan också använda den om du misstänker att CRX eller ditt program lämnar filhandtag öppna. Konfigurera följande variabler innan du använder skriptet: `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. Om du vill använda skriptet konfigurerar du det som ett cron-jobb.
